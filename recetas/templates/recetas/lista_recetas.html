{% extends 'recetas/base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">

    <!-- T칤tulo -->
    <h2 class="text-center section-title mb-4 animate-fadeInDown">Explora todas las recetas</h2>

    <!-- Barra de b칰squeda y filtros -->
    <form method="get" class="mb-5 animate-fadeInDown">
        <div class="row g-2 justify-content-center">
            <div class="col-md-4">
                <input type="text" name="q" class="form-control" placeholder="Buscar por t칤tulo..."
                    value="{{ request.GET.q }}">
            </div>
            <div class="col-md-2">
                <select name="categoria" class="form-select">
                    <option value="">Categor칤a</option>
                    <option value="Desayunos">Desayunos</option>
                    <option value="Almuerzos">Almuerzos</option>
                    <option value="Cenas">Cenas</option>
                    <option value="Postres">Postres</option>
                    <option value="Bebidas">Bebidas</option>
                    <option value="Vegetariano">Vegetariano</option>
                    <option value="Vegano">Vegano</option>
                </select>
            </div>
            <div class="col-md-2">
                <select name="dificultad" class="form-select">
                    <option value="">Dificultad</option>
                    <option value="F치cil">F치cil</option>
                    <option value="Intermedio">Intermedio</option>
                    <option value="Dif칤cil">Dif칤cil</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-gold w-100" type="submit">Filtrar</button>
            </div>
        </div>
    </form>

    <!-- Lista de recetas -->
    {% if recetas %}
    <div class="row row-cols-1 row-cols-md-3 g-4 animate-fadeInUp">
        {% for receta in recetas %}
        <div class="col">
            <div class="card h-100 receta-card">

                <!-- Imagen + Etiquetas + Bot칩n coraz칩n -->
                <div class="position-relative">
                    {% if receta.imagen %}
                    <img src="{{ receta.imagen.url }}" class="card-img-top" alt="Imagen de {{ receta.titulo }}"
                        style="height:200px; object-fit:cover;">
                    {% endif %}

                    <!-- Etiquetas -->
                    <div class="position-absolute top-0 start-0 m-2 d-flex flex-wrap gap-1">
                        {% for cat in receta.categorias_list %}
                        <span class="badge bg-dark text-light small">{{ cat }}</span>
                        {% endfor %}
                        {% for al in receta.alergias_list %}
                        <span class="badge bg-danger small">{{ al }}</span>
                        {% endfor %}
                    </div>

                    <!-- Bot칩n favorito -->
                    <button class="btn btn-light btn-sm btn-heart position-absolute bottom-0 end-0 m-2">
                        <i class="bi bi-heart"></i>
                    </button>
                </div>

                <!-- Cuerpo -->
                <div class="card-body">
                    <h5 class="card-title fw-bold text-dark">{{ receta.titulo }}</h5>
                    <p class="text-muted small mb-2">
                        <i class="bi bi-person-circle"></i> {{ receta.autor.username }}
                        &nbsp; | &nbsp;
                        <i class="bi bi-clock"></i> {{ receta.tiempo }} min
                        &nbsp; | &nbsp;
                        <i class="bi bi-people"></i> {{ receta.porciones }}
                    </p>
                    <p class="card-text text-dark">{{ receta.descripcion|truncatechars:90 }}</p>
                </div>

                <!-- Footer -->
                <div class="card-footer bg-transparent border-0 d-flex justify-content-between align-items-center">
                    <!-- Likes + Calificaci칩n -->
                    <div class="d-flex align-items-center gap-3">
                        <small class="text-muted"><i class="bi bi-heart-fill text-danger"></i> 12</small>
                        <small class="text-muted"><i class="bi bi-star-fill text-warning"></i> 4.2</small>
                    </div>

                    <!-- Ver receta -->
                    <a href="{% url 'detalle_receta' receta.id %}" class="btn btn-gold px-4 py-2 fw-bold">
                        Ver receta
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-recetas-container">
        <p class="text-center text-gold fw-bold py-5">No hay recetas publicadas a칰n. S칠 el primero en crear una 游눩.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
